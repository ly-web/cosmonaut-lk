<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml'>
    <head>
        <meta http-equiv='Content-Type' content='text/html; charset=GB2312'/>
        <link type='text/css' href='c_000.css' rel='stylesheet'/>
        <script language='javascript' type='text/javascript'>
            var language=1;
            var Json;
            var lang=
            {
                N01:['告警记录','Alarm Records'],
                N02:['详细记录','Detailed Records'],
                N03:['序号','No.'],
                N04:['时间','Time'],
                N05:['告警名称','Alarm Name'],
                N06:['一共','Total '],
                N07:['页，共',' pages, '],
                N08:['页，共',' page, '],
                N09:['条记录',' records'],
                N10:['条记录',' record'],
                N11:['无记录。',' No record.'],

                //32位告警定义
				N12:['储能逆变器故障告警','PCS Fault Alarm'],
				N13:['储能逆变器通讯故障告警','PCS Comm Fault Alarm'],
				N14:['光伏逆变器故障告警','PV Fault Alarm'],
				N15:['光伏逆变器通讯故障告警','PV Comm Fault Alarm'],
				N16:['电网侧接触器告警','Grid-side Contact Alarm'],
				N17:['微网侧接触器告警','MG-side Contact Alarm'],
				N18:['储能逆变器交流未连接','PCS AC-side Disconnect'],
				N19:['一组或多组电池电量低','One or More Low Battery'],
				N20:['一组或多组电池电量高','One or More High Battery'],
				N21:['BMS通讯故障告警','BMS Comm Fault Alarm'],
				N22:['BMS故障告警','BMS Fault Alarm'],
				N23:['BMS告警','BMS Alarm'],
				N24:['DCDC故障告警','DCDC Fault Alarm'],
				N25:['DCDC通讯故障告警','DCDC Comm Fault Alarm'],
				N26:['DSP通讯故障告警','DSP Comm Fault Alarm'],
				N27:['电表通讯故障告警','Ammeter Comm Fault Alarm'],
				N28:['汇流箱通讯故障告警','PVS Comm Fault Alarm'],
				N29:['环境检测仪通讯故障告警','Env-Detector Comm Fault Alarm'],
				N30:['',''],
				N31:['',''],
				N32:['节点1告警','Node 1 Alarm'],
				N33:['节点2告警','Node 2 Alarm'],
				N34:['节点3告警','Node 3 Alarm'],
				N35:['节点4告警','Node 4 Alarm'],
				N36:['节点5告警','Node 5 Alarm'],
				N37:['节点6告警','Node 6 Alarm'],
				N38:['节点7告警','Node 7 Alarm'],
				N39:['节点8告警','Node 8 Alarm'],
				N40:['',''],
				N41:['',''],
				N42:['',''],
				N43:['',''],
				
                N77:['导出','Export']
			};
        </script>
        <script src='j_000.js' type='text/javascript'></script>
        <style type='text/css'>
            .inquery{margin:5px auto;width:780px;_width:770px;text-align:right;padding-right:10px;}
            .txt{margin:0 10px;width:120px;}
            .PagerView{font-size:12px;font-family:tahoma,arial;color:#333;text-align:center;padding:8px;line-height:100%;}
            .PagerView span{color:#999;margin:0 1px;padding:3px 6px;border:1px solid #ccc;}
            .PagerView span.on{color:#fff;font-weight:bold;border:1px solid #666;background:#39f;}
            .PagerView a{color:#00f;text-decoration:none;}
            .PagerView a span{color:#33f;border:1px solid #66c;}
            .pager{width:780px;margin:0 auto;}
        </style>
    </head>
    <body onload='Init()'>
        <script type='text/javascript'>
            show_T('N01');
        </script>
		<div class='title'>
			<div class='subtitle'>
				<div class='r1 subcolor'></div>
				<div class='r2 subcolor'></div>
				<div class='r3 subcolor'></div>
				<div class='r4 subcolor'></div>
				<div class='content subcolor subcontent'>
					<span id='N02'></span>
				</div>
				<div class='r4 subcolor'></div>
				<div class='r3 subcolor'></div>
				<div class='r2 subcolor'></div>
				<div class='r1 subcolor'></div>
				</div>
				<div class='line_short'></div>
				<button id='Exp' style='float:right;display:inline;margin-top:-30px;width:75px;height:24px;margin-right:20px;' onclick='Export()'><span id='N77'></span></button>
			</div>
		</div>
        <div class='blank'></div>
        <table width='90%' border='0' style=' margin:0 auto;'>
            <tr>
                <td>
                    <table width='100%' border='0' style='border-collapse:collapse;border:1px #aaa solid;'>
                        <tr>
                            <th width='100' scope='col'><span id='N03'></span></span></th>
                            <th width='332' scope='col'><span id='N04'></span></th>
                            <th width='332' scope='col'><span id='N05'></span></th>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td>
                    <table width='100%' border='0' style='margin-top:2px;border-collapse:collapse;border:1px #ddd solid;text-align:center'>
                        <script type='text/javascript'>
                            var str='';
                            for(var i=1;i<=10;i++)
                            {
                                str+="<tr class='"+(i%2?"odd":"even")+"'>";
                                str+="<td id='r"+(i<10?("0"+i):i)+"1' width='100'></td>";
                                str+="<td id='r"+(i<10?("0"+i):i)+"2' width='332'></td>";
                                str+="<td id='r"+(i<10?("0"+i):i)+"3' width='332' style='color:#FF9500'></td>";
                                str+="</tr>";
                            }
                            document.write(str);
                        </script>
                    </table>
                    <img id='waiting' style='margin:0 auto;z-index:20000;position:relative;top:-168px;' src='i_002.gif'/>
                </td>
            </tr>
        </table>
        <br/>
        <div id='pager'></div>
        <table width='90%' border='0'><tr><td width='100%' class='even tip'><span id='tip'>&nbsp;</span></td></tr></table>
        <div class='btm_blank'></div>
        <!--[if IE 6]><script type='text/javascript'>document.execCommand('BackgroundImageCache',false,true);</script><![endif]-->
    </body>
    <script type='text/javascript'>
        window.history.forward(1);
        var pager;
        var tid;
        var temp;
        var page_num=1;
        var F_id=new Array('1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32');
		var F_name=new Array('12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40','41','42','43');

        //测试
        Json={ID_0x0301:85, ID_0x0300:0};

        function Export()
        {
            var start = 0xFFFF;
            for(var i = 0; i < 5; i++)
            {
                var URL='s_029.html?0x'+start.toString(16).toUpperCase();
                var xmlhttp;
                if(window.XMLHttpRequest)xmlhttp=new XMLHttpRequest();
                else xmlhttp=new ActiveXObject('Microsoft.XMLHTTP');
                //xmlhttp.onreadystatechange=function() 
                {
                    //if(xmlhttp.readyState==4 && xmlhttp.status==200)
                    {
                        //eval('Json='+xmlhttp.responseText);
                        if(Json.ID_0x0300==0 && start != 0xFFFE){
                            start = 0xFFFE;
                            $('Exp').disabled = true;
                            $('waiting').style.display='inline';
                            if(document.all){
                                var referLink = document.createElement('a');
                                referLink.href = 'Alarm_Records.csv';
                                document.body.appendChild(referLink);
                                referLink.click();
                            }else{
                                location.href='Alarm_Records.csv';
                            }
                        }else if(Json.ID_0x0300 == 1){
                            $('Exp').disabled = false;
                            $('waiting').style.display='none';
                            return;
                        }
                    }
                };
                //同步发送
                URL = URL+'&time='+new Date();
                //xmlhttp.open('GET',URL,false);
                //xmlhttp.send();                
            }
            $('Exp').disabled = false;
            $('waiting').style.display='none';
        }
        function Init()
        {
			FromWhichDevice();
			if(FromMobileDevice==true)$('Exp').style.display='none';

           	var URL='s_029.html?0x0000&time='+new Date();
            var xmlhttp;
            if(window.XMLHttpRequest)xmlhttp=new XMLHttpRequest();
            else xmlhttp=new ActiveXObject('Microsoft.XMLHTTP');
            //xmlhttp.onreadystatechange=function()
            {
                //if(xmlhttp.readyState==4 && xmlhttp.status==200)
                {
                    //eval('Json='+xmlhttp.responseText);
					if(Json.ID_0x0301==0x55)language=0;else language=1;
					lang_init(5);
					$('N77').innerHTML=lang.N77[language];
					doSubmit();
					show_tip('&nbsp;');
        		}
            };
            xmlhttp.open('GET',URL,true);
            xmlhttp.send();
     	}
        function doSubmit()
        {
        	//测试
			temp={'r':[
			{'C1':1,'C2':'2014/08/13&nbsp;&nbsp;15:10:42','C3':'1'},
			{'C1':2,'C2':'2014/08/13&nbsp;&nbsp;15:10:37','C3':'2'},
			{'C1':3,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'3'},
			{'C1':4,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'4'},
			{'C1':5,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'5'},
			{'C1':6,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'6'},
			{'C1':7,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'7'},
			{'C1':8,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'8'},
			{'C1':9,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'9'},
			{'C1':10,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'10'},
			{'end':0}]};Records=14;

            var URL='r_029.html?'
            +'Y='+2000
            +'&M='+1
            +'&D='+1
            +'&P='+page_num
            +'&time='+new Date();
            var xmlhttp;
            if(window.XMLHttpRequest)xmlhttp=new XMLHttpRequest();
            else xmlhttp=new ActiveXObject('Microsoft.XMLHTTP');
            //xmlhttp.onreadystatechange=function()
            {
                //if(xmlhttp.readyState==4 && xmlhttp.status==200)
                {
					show_tip('&nbsp;');
					//eval('temp='+xmlhttp.responseText);
					loop=temp.r.length-1;
					for(var aa=0;aa<loop;aa++)
					{
						tid=(aa<9)?'0'+(aa+1):aa+1;
						for(var j=1;j<=3;j++)
						{
							eval("$('r'+tid+'"+j+"').innerHTML=temp.r[aa].C"+j+";");
							if(j==3)for(var k=0;k<F_id.length;k++)eval("eval(\"if(temp.r[aa].C\"+\""+j+"==F_id[k])$('r\"+\""+tid+"3').innerHTML=lang.N"+F_name[k]+"[language];\")");
						}
					}
					for(var bb=loop;bb<10;bb++)
					{
						tid=(bb<9)?'0'+(bb+1):bb+1;
						for(var k=1;k<=3;k++)$('r'+tid+k).innerHTML='';
					}
					if(Records==0)$('Exp').disabled=true;else $('Exp').disabled=false;
					if(Records<=10)
					{
						if(Records==0)
						{
							show_tip(lang.N11[language]);
							$('waiting').style.display='none';
							$('pager').style.display='none';
							return false;
						}
						else if(Records==1)
						{
							$('pager').style.display='block';
							pager=new PagerView('pager',lang.N06[language],lang.N08[language],lang.N10[language]);
						}
						else
						{
							$('pager').style.display='block';
							pager=new PagerView('pager',lang.N06[language],lang.N08[language],lang.N09[language]);
						}
					}
					else
					{
						$('pager').style.display='block';
						pager=new PagerView('pager',lang.N06[language],lang.N07[language],lang.N09[language]);
					}
					pager.itemCount=Records;
					pager.size=10;
					pager.index=1;
					pager.onclick=function(index)
					{
						//测试

						//temp={'r':[
						//{'C1':1,'C2':'2014/08/13&nbsp;&nbsp;15:10:42','C3':'2'},
						//{'C1':2,'C2':'2014/08/13&nbsp;&nbsp;15:10:37','C3':'4'},
						//{'C1':3,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'7'},
						//{'C1':4,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'19'},
						//{'C1':5,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'13'},
						//{'C1':6,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'12'},
						//{'C1':7,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'18'},
						//{'C1':8,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'9'},
						//{'C1':9,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'10'},
						//{'C1':10,'C2':'2014/08/13&nbsp;&nbsp;11:46:23','C3':'1'},
						//{'end':0}]};Records=14;

                        var URL='r_029.html?'
                        +'Y='+2000
                        +'&M='+1
                        +'&D='+1
                        +'&P='+index
                        +'&time='+new Date();

                        var xmlhttp;
                        if(window.XMLHttpRequest)xmlhttp=new XMLHttpRequest();
                        else xmlhttp=new ActiveXObject('Microsoft.XMLHTTP');
                        xmlhttp.onreadystatechange=function()
                        {
                            if(xmlhttp.readyState==4 && xmlhttp.status==200)
                            {
                            	show_tip('&nbsp;');
                                eval('temp='+xmlhttp.responseText);
                            	if(temp.r.length>10)
                            	{
									loop=10;	
                            	}
                            	else
                            	{
                            		loop=temp.r.length-1;
                            	}
                            	for(var cc=0;cc<loop;cc++)
                            	{
                            		tid=(cc<9)?'0'+(cc+1):cc+1;
                            		for(var j=1;j<=3;j++)
                            		{
                            			eval("$('r'+tid+'"+j+"').innerHTML=temp.r[cc].C"+j+";");
                            			if(j==3)for(var k=0;k<F_id.length;k++)eval("eval(\"if(temp.r[cc].C\"+\""+j+"==F_id[k])$('r\"+\""+tid+"3').innerHTML=lang.N"+F_name[k]+"[language];\")");
                            		}
                            	}
                            	for(var dd=loop;dd<10;dd++)
                            	{
                            		tid=(dd<9)?'0'+(dd+1):dd+1;
                            		for(var k=1;k<=3;k++)$('r'+tid+k).innerHTML='';
                            	}
                            	$('waiting').style.display='none';
                        	}
                    	};
                    	xmlhttp.open('GET',URL,true);
                    	xmlhttp.send();
                    	$('waiting').style.display='inline';
                	};
                	pager.render();
                	$('waiting').style.display='none';
                }
            };
            xmlhttp.open('GET',URL,true);
            xmlhttp.send();
            $('waiting').style.display='inline';
        }
    </script>
</html>
